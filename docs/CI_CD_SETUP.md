# Настройка CI/CD для автоматического деплоя на VPS

Эта инструкция поможет вам настроить автоматическое развертывание вашего приложения на VPS при каждом пуше в main/master ветку.

## Шаг 1: Подготовка VPS

1. Запустите скрипт первоначальной настройки на вашем VPS:

```bash
# Сделайте скрипт исполняемым
chmod +x scripts/setup-vps.sh

# Запустите скрипт (требуются права sudo)
sudo ./scripts/setup-vps.sh
```

2. Создайте директорию для проекта и настройте ее:

```bash
# Создайте директорию проекта (если не сделано скриптом)
mkdir -p /var/www/app
cd /var/www/app

# Клонируйте репозиторий
git clone https://github.com/your-username/your-repo.git .
```

## Шаг 2: Настройка GitHub Secrets

В вашем GitHub репозитории перейдите в Settings -> Secrets and variables -> Actions и добавьте следующие секреты:

1. `SSH_HOST` - IP-адрес или домен вашего VPS
2. `SSH_PORT` - SSH порт (обычно 22)
3. `SSH_USERNAME` - имя пользователя для SSH подключения
4. `SSH_PRIVATE_KEY` - приватный SSH ключ для подключения (содержимое файла ~/.ssh/id_rsa)
5. `PROJECT_PATH` - путь к директории проекта (например, /var/www/app)
6. `ENV_FILE` - содержимое файла .env для вашего проекта

### Создание SSH ключа

Если у вас еще нет SSH ключа:

```bash
# Генерация SSH ключа
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# Добавление публичного ключа на сервер
ssh-copy-id username@your_server_ip
```

## Шаг 3: Первый деплой

Для проверки работы CI/CD:

1. Внесите изменения в репозиторий
2. Сделайте коммит и пуш в main ветку:

```bash
git add .
git commit -m "Test CI/CD deployment"
git push origin main
```

3. Проверьте вкладку Actions в GitHub для отслеживания процесса деплоя

## Мониторинг и устранение неполадок

### Проверка логов GitHub Actions

Перейдите в раздел Actions вашего репозитория для просмотра логов выполнения.

### Проверка логов на сервере

```bash
# Логи Docker контейнеров
make logs

# Логи отдельных контейнеров
docker logs backend
docker logs frontend
docker logs postgres
```

## Дополнительные настройки безопасности

1. Настройте файрвол на вашем VPS
2. Отключите вход по паролю, оставив только вход по SSH ключу
3. Рассмотрите использование HTTPS и настройку SSL сертификатов 